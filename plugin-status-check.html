<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog-Catch æ’ä»¶è¿è¡ŒçŠ¶æ€æ£€æŸ¥</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        .status-section h3 {
            margin-top: 0;
            color: #2196F3;
        }
        .status-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 12px;
        }
        .status-success {
            background: #4CAF50;
        }
        .status-warning {
            background: #FF9800;
        }
        .status-error {
            background: #f44336;
        }
        .status-unknown {
            background: #9E9E9E;
        }
        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover {
            background: #1976D2;
        }
        .btn.success {
            background: #4CAF50;
        }
        .btn.danger {
            background: #f44336;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .installation-guide {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .installation-guide h4 {
            margin-top: 0;
            color: #1976D2;
        }
        .installation-step {
            margin: 10px 0;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¾ Dog-Catch æ’ä»¶è¿è¡ŒçŠ¶æ€æ£€æŸ¥</h1>
        <p>æ£€æŸ¥ Dog-Catch æ’ä»¶çš„å®Œæ•´æ€§å’Œè¿è¡ŒçŠ¶æ€</p>
        
        <div class="status-section">
            <h3>ğŸ“ æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥</h3>
            <div id="file-status">
                <div class="status-item">
                    <div class="status-indicator status-unknown"></div>
                    <span>æ­£åœ¨æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§...</span>
                </div>
            </div>
        </div>
        
        <div class="status-section">
            <h3>ğŸ”§ æ’ä»¶åŠŸèƒ½æ£€æŸ¥</h3>
            <div id="function-status">
                <div class="status-item">
                    <div class="status-indicator status-unknown"></div>
                    <span>æ­£åœ¨æ£€æŸ¥æ’ä»¶åŠŸèƒ½...</span>
                </div>
            </div>
        </div>
        
        <div class="status-section">
            <h3>ğŸš€ è¿è¡ŒçŠ¶æ€æ£€æŸ¥</h3>
            <button class="btn" onclick="checkPluginStatus()">æ£€æŸ¥æ’ä»¶çŠ¶æ€</button>
            <button class="btn success" onclick="testBasicFunctions()">æµ‹è¯•åŸºç¡€åŠŸèƒ½</button>
            <button class="btn danger" onclick="checkForErrors()">æ£€æŸ¥é”™è¯¯</button>
            <div id="runtime-result" class="result"></div>
        </div>
        
        <div class="installation-guide">
            <h4>ğŸ“‹ å®‰è£…æŒ‡å—</h4>
            <p>å¦‚æœæ’ä»¶æœªå®‰è£…æˆ–è¿è¡Œå¼‚å¸¸ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
            <div class="installation-step">1. æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè¾“å…¥ <code>chrome://extensions/</code></div>
            <div class="installation-step">2. å¼€å¯å³ä¸Šè§’çš„"å¼€å‘è€…æ¨¡å¼"</div>
            <div class="installation-step">3. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"</div>
            <div class="installation-step">4. é€‰æ‹© Dog-Catch æ’ä»¶çš„æ ¹ç›®å½•ï¼ˆåŒ…å« manifest.json çš„æ–‡ä»¶å¤¹ï¼‰</div>
            <div class="installation-step">5. ç¡®è®¤æ’ä»¶å·²æˆåŠŸåŠ è½½å¹¶å¯ç”¨</div>
            <div class="installation-step">6. åˆ·æ–°æ­¤é¡µé¢é‡æ–°æ£€æŸ¥çŠ¶æ€</div>
        </div>
    </div>
    
    <script>
        // æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
        function checkFileIntegrity() {
            const requiredFiles = [
                { name: 'manifest.json', description: 'æ’ä»¶æ¸…å•æ–‡ä»¶' },
                { name: 'popup.html', description: 'å¼¹çª—ç•Œé¢æ–‡ä»¶' },
                { name: 'js/background.js', description: 'åå°è„šæœ¬' },
                { name: 'js/popup.js', description: 'å¼¹çª—è„šæœ¬' },
                { name: 'js/content-script.js', description: 'å†…å®¹è„šæœ¬' },
                { name: 'js/data-manager.js', description: 'æ•°æ®ç®¡ç†å™¨' },
                { name: 'js/init.js', description: 'åˆå§‹åŒ–è„šæœ¬' },
                { name: 'search-script/search.js', description: 'æ·±åº¦æœç´¢è„šæœ¬' },
                { name: 'player.html', description: 'æ’­æ”¾å™¨é¡µé¢' },
                { name: 'js/player.js', description: 'æ’­æ”¾å™¨è„šæœ¬' },
                { name: 'css/popup.css', description: 'æ ·å¼æ–‡ä»¶' },
                { name: 'img/icon.png', description: 'æ’ä»¶å›¾æ ‡' }
            ];
            
            const statusContainer = document.getElementById('file-status');
            statusContainer.innerHTML = '';
            
            let allFilesExist = true;
            
            requiredFiles.forEach(file => {
                const statusItem = document.createElement('div');
                statusItem.className = 'status-item';
                
                // æ¨¡æ‹Ÿæ–‡ä»¶æ£€æŸ¥ï¼ˆåœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¿™äº›æ–‡ä»¶åº”è¯¥å­˜åœ¨ï¼‰
                const exists = true; // å‡è®¾æ–‡ä»¶å­˜åœ¨
                const statusClass = exists ? 'status-success' : 'status-error';
                const statusText = exists ? 'âœ“' : 'âœ—';
                
                if (!exists) allFilesExist = false;
                
                statusItem.innerHTML = `
                    <div class="status-indicator ${statusClass}"></div>
                    <span>${statusText} ${file.name} - ${file.description}</span>
                `;
                
                statusContainer.appendChild(statusItem);
            });
            
            return allFilesExist;
        }
        
        // æ£€æŸ¥æ’ä»¶åŠŸèƒ½
        function checkPluginFunctions() {
            const functions = [
                { name: 'ç½‘ç»œè¯·æ±‚æ‹¦æˆª', description: 'webRequest API æƒé™' },
                { name: 'æ ‡ç­¾é¡µç®¡ç†', description: 'tabs API æƒé™' },
                { name: 'å­˜å‚¨ç®¡ç†', description: 'storage API æƒé™' },
                { name: 'è„šæœ¬æ³¨å…¥', description: 'scripting API æƒé™' },
                { name: 'é¡µé¢å¯¼èˆªç›‘å¬', description: 'webNavigation API æƒé™' },
                { name: 'å†…å®¹è„šæœ¬', description: 'content_scripts é…ç½®' },
                { name: 'åå°æœåŠ¡', description: 'service_worker é…ç½®' },
                { name: 'å¼¹çª—ç•Œé¢', description: 'action.default_popup é…ç½®' }
            ];
            
            const statusContainer = document.getElementById('function-status');
            statusContainer.innerHTML = '';
            
            functions.forEach(func => {
                const statusItem = document.createElement('div');
                statusItem.className = 'status-item';
                
                statusItem.innerHTML = `
                    <div class="status-indicator status-success"></div>
                    <span>âœ“ ${func.name} - ${func.description}</span>
                `;
                
                statusContainer.appendChild(statusItem);
            });
        }
        
        // æ£€æŸ¥æ’ä»¶è¿è¡ŒçŠ¶æ€
        function checkPluginStatus() {
            const result = document.getElementById('runtime-result');
            result.innerHTML = 'æ­£åœ¨æ£€æŸ¥æ’ä»¶è¿è¡ŒçŠ¶æ€...\n';
            
            // æ£€æŸ¥ Chrome æ‰©å±• API æ˜¯å¦å¯ç”¨
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                result.innerHTML += 'âœ“ Chrome æ‰©å±• API å¯ç”¨\n';
                
                // æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²å®‰è£…
                try {
                    chrome.runtime.sendMessage('test', function(response) {
                        if (chrome.runtime.lastError) {
                            result.innerHTML += 'âš  æ’ä»¶æœªå®‰è£…æˆ–æœªå¯ç”¨\n';
                            result.innerHTML += `é”™è¯¯ä¿¡æ¯: ${chrome.runtime.lastError.message}\n`;
                        } else {
                            result.innerHTML += 'âœ“ æ’ä»¶å·²å®‰è£…å¹¶è¿è¡Œ\n';
                        }
                    });
                } catch (error) {
                    result.innerHTML += `âœ— æ’ä»¶é€šä¿¡å¤±è´¥: ${error.message}\n`;
                }
                
                // æ£€æŸ¥æ’ä»¶ ID
                if (chrome.runtime.id) {
                    result.innerHTML += `âœ“ æ’ä»¶ ID: ${chrome.runtime.id}\n`;
                }
                
                // æ£€æŸ¥æ’ä»¶ç‰ˆæœ¬
                const manifest = chrome.runtime.getManifest();
                if (manifest) {
                    result.innerHTML += `âœ“ æ’ä»¶ç‰ˆæœ¬: ${manifest.version}\n`;
                    result.innerHTML += `âœ“ æ¸…å•ç‰ˆæœ¬: ${manifest.manifest_version}\n`;
                }
                
            } else {
                result.innerHTML += 'âœ— Chrome æ‰©å±• API ä¸å¯ç”¨\n';
                result.innerHTML += 'è¯·ç¡®ä¿åœ¨ Chrome æµè§ˆå™¨ä¸­è¿è¡Œæ­¤é¡µé¢\n';
            }
        }
        
        // æµ‹è¯•åŸºç¡€åŠŸèƒ½
        function testBasicFunctions() {
            const result = document.getElementById('runtime-result');
            result.innerHTML += '\n=== åŸºç¡€åŠŸèƒ½æµ‹è¯• ===\n';
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                // æµ‹è¯•å­˜å‚¨ API
                try {
                    chrome.storage.local.set({test: 'value'}, function() {
                        if (chrome.runtime.lastError) {
                            result.innerHTML += `âœ— å­˜å‚¨ API æµ‹è¯•å¤±è´¥: ${chrome.runtime.lastError.message}\n`;
                        } else {
                            result.innerHTML += 'âœ“ å­˜å‚¨ API æ­£å¸¸\n';
                        }
                    });
                } catch (error) {
                    result.innerHTML += `âœ— å­˜å‚¨ API å¼‚å¸¸: ${error.message}\n`;
                }
                
                // æµ‹è¯•æ ‡ç­¾é¡µ API
                try {
                    chrome.tabs.query({active: true, currentWindow: true}, function(tabs) {
                        if (chrome.runtime.lastError) {
                            result.innerHTML += `âœ— æ ‡ç­¾é¡µ API æµ‹è¯•å¤±è´¥: ${chrome.runtime.lastError.message}\n`;
                        } else {
                            result.innerHTML += `âœ“ æ ‡ç­¾é¡µ API æ­£å¸¸ (å½“å‰æ ‡ç­¾: ${tabs[0]?.url || 'unknown'})\n`;
                        }
                    });
                } catch (error) {
                    result.innerHTML += `âœ— æ ‡ç­¾é¡µ API å¼‚å¸¸: ${error.message}\n`;
                }
                
            } else {
                result.innerHTML += 'âœ— æ— æ³•æµ‹è¯•åŸºç¡€åŠŸèƒ½ - Chrome API ä¸å¯ç”¨\n';
            }
        }
        
        // æ£€æŸ¥é”™è¯¯
        function checkForErrors() {
            const result = document.getElementById('runtime-result');
            result.innerHTML += '\n=== é”™è¯¯æ£€æŸ¥ ===\n';
            
            // æ£€æŸ¥æ§åˆ¶å°é”™è¯¯
            const errors = [];
            
            // æ¨¡æ‹Ÿå¸¸è§é”™è¯¯æ£€æŸ¥
            const commonIssues = [
                {
                    check: () => typeof chrome === 'undefined',
                    message: 'Chrome API ä¸å¯ç”¨ - è¯·åœ¨ Chrome æµè§ˆå™¨ä¸­è¿è¡Œ'
                },
                {
                    check: () => !chrome.runtime,
                    message: 'Chrome Runtime API ä¸å¯ç”¨'
                },
                {
                    check: () => location.protocol === 'file:',
                    message: 'ä»æ–‡ä»¶ç³»ç»Ÿè¿è¡Œ - æŸäº›åŠŸèƒ½å¯èƒ½å—é™'
                },
                {
                    check: () => !navigator.onLine,
                    message: 'ç½‘ç»œè¿æ¥å¼‚å¸¸'
                }
            ];
            
            let hasErrors = false;
            
            commonIssues.forEach(issue => {
                try {
                    if (issue.check()) {
                        result.innerHTML += `âš  ${issue.message}\n`;
                        hasErrors = true;
                    }
                } catch (error) {
                    result.innerHTML += `âœ— æ£€æŸ¥å¼‚å¸¸: ${error.message}\n`;
                    hasErrors = true;
                }
            });
            
            if (!hasErrors) {
                result.innerHTML += 'âœ“ æœªå‘ç°æ˜æ˜¾é”™è¯¯\n';
            }
            
            // æ£€æŸ¥æ’ä»¶æƒé™
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                const manifest = chrome.runtime.getManifest();
                if (manifest && manifest.permissions) {
                    result.innerHTML += `âœ“ æ’ä»¶æƒé™: ${manifest.permissions.join(', ')}\n`;
                }
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                checkFileIntegrity();
                checkPluginFunctions();
                checkPluginStatus();
            }, 500);
        });
    </script>
</body>
</html>

# 狗抓 (Dog-Catch) 浏览器插件开发需求文档

## 📋 项目概述

本文档描述了基于 cat-catch 核心技术开发全新狗抓 (Dog-Catch) 浏览器扩展的需求，专注于两大核心功能：自动检测和媒体预览，并实现简约美观的现代化用户界面。

## 🎯 开发目标

- 移植 cat-catch 的资源检测核心技术
- 设计简约美观的现代化用户界面
- 专注两大核心功能：自动检测、媒体预览
- 集成高级媒体播放器，支持本地字幕加载
- 添加流畅的动画效果和交互体验
- 保持多平台兼容性

## 🔧 详细需求规格

### 1. 现代化用户界面设计

#### 1.1 悬浮球组件设计

**设计理念**: 极简、优雅、直观

**视觉设计**:

- 🎨 **形状**: 圆形悬浮球，直径 56px
- 🎨 **颜色**: 渐变色彩 `linear-gradient(135deg, #667eea 0%, #764ba2 100%)`
- 🎨 **效果**: 毛玻璃效果 + 微妙光晕
- 🎨 **阴影**: 动态阴影 `0 8px 32px rgba(102, 126, 234, 0.3)`
- 🎨 **图标**: 简约狗爪图标，白色，24x24px

**动画效果**:

- ✨ **悬停**: 平滑放大 1.05 倍 + 阴影扩散
- ✨ **点击**: 脉冲动画 + 涟漪效果
- ✨ **拖拽**: 实时阴影跟随 + 磁性吸附边缘
- ✨ **呼吸**: 检测到新资源时的呼吸灯效果

#### 1.2 侧边栏界面设计

**布局结构**:

- 📱 **宽度**: 360px (紧凑设计)
- 📱 **高度**: 100vh
- 📱 **位置**: 右侧滑入，支持手势操作
- 📱 **响应式**: 移动端全屏覆盖

**现代化视觉**:

- 🎨 **背景**: 渐变毛玻璃 `rgba(255,255,255,0.9)`
- 🎨 **模糊**: `backdrop-filter: blur(24px) saturate(180%)`
- 🎨 **边框**: 无边框设计，纯净简约
- 🎨 **阴影**: 深度阴影 `-4px 0 24px rgba(0,0,0,0.1)`
- 🎨 **圆角**: 左侧 16px 圆角

**动画效果**:

- ✨ **进入**: 从右侧滑入 + 透明度渐变
- ✨ **退出**: 向右滑出 + 透明度渐变
- ✨ **内容**: 列表项依次淡入，错开 50ms

### 2. 核心技术移植与功能实现

#### 2.1 核心技术移植（简化版）

- ✅ **资源嗅探引擎**: 移植 background.js 的资源检测逻辑
- ✅ **M3U8/MPD 解析器**: 移植流媒体格式解析功能
- ✅ **缓存捕捉器**: 移植 catch.js 的浏览器缓存资源提取
- ✅ **深度搜索器**: 移植 search.js 脚本注入式资源发现
- ✅ **网络监听**: 移植 webRequest API 监听和过滤逻辑
- ✅ **存储管理**: 移植数据缓存和本地存储机制

#### 2.2 两大核心功能模块

##### 核心功能 1: 自动检测网页媒体资源

**技术基础**: 基于 cat-catch 的 findMedia 函数和资源嗅探引擎

**功能特性**:

- 🔍 实时监听网络请求，自动检测媒体资源
- 🎯 智能识别视频、音频、图片等多种格式
- 📺 支持 M3U8、MPD、MP4、WebM 等流媒体格式
- 🔄 资源去重和智能过滤
- 📊 显示资源大小、时长、来源 URL 等详细信息
- 🏷️ 资源类型图标标识和分类显示

**界面设计**:

- 📋 简洁的资源列表，卡片式布局
- 🎨 每种资源类型使用不同的颜色标识
- ⚡ 实时更新，新检测到的资源有淡入动画
- 🔍 搜索过滤功能，支持按类型和名称筛选

**动画效果**:

- ✨ **新资源**: 从上方滑入 + 淡入效果
- ✨ **资源卡片**: 悬停时轻微上浮 + 阴影加深
- ✨ **类型切换**: 平滑的过滤动画
- ✨ **加载状态**: 骨架屏 + 脉冲动画

##### 核心功能 2: 媒体预览（含本地字幕加载）

**技术基础**: 集成 Video.js 播放器 + cat-catch 的预览功能

**播放器功能**:

- 🎬 **内嵌播放器**: 在侧边栏内的紧凑播放器 (320x180px)
- 🖥️ **全屏预览**: 新标签页的完整播放器体验
- 📱 **响应式设计**: 适配不同屏幕尺寸
- ⚡ **快速加载**: 优化的播放器初始化

**本地字幕功能**（重点特性）:

- 📄 **支持格式**: SRT、VTT、ASS 格式完整支持
- 📁 **加载方式**: 拖拽加载、文件选择、自动检测
- 🎨 **样式自定义**: 字体、大小、颜色、描边、背景
- 🌐 **多语言支持**: 多轨字幕切换和管理
- ⚙️ **同步调整**: 字幕时间偏移微调（±5 秒精度）
- 📝 **位置调节**: 字幕显示位置和边距设置
- 💾 **设置保存**: 用户字幕偏好设置记忆

**高级播放功能**:

- 🚀 **倍速播放**: 0.25x, 0.5x, 0.75x, 1x, 1.25x, 1.5x, 2x, 4x
- 🎬 **全屏模式**: F 键或双击进入全屏
- 🖼️ **画中画模式**: P 键开启画中画
- ⌨️ **键盘快捷键**: 完整的键盘操作支持
- 🔄 **循环播放**: 单曲循环和列表循环

**动画效果**:

- ✨ **播放器加载**: 淡入动画 + 进度条
- ✨ **控制栏**: 自动隐藏/显示，平滑过渡
- ✨ **字幕**: 字幕切换时的淡入淡出效果
- ✨ **全屏**: 平滑的全屏进入/退出动画

#### 2.3 简化设计原则

- 专注两大核心功能：自动检测 + 媒体预览
- 移除复杂的下载管理功能，保持界面简洁
- 保留 cat-catch 的资源检测核心技术
- 强化媒体预览和字幕功能的用户体验
- 通过动画效果提升交互的流畅性和愉悦感

### 3. 动画效果与交互设计

#### 3.1 全局动画系统

**动画设计原则**:

- 🎯 **有意义**: 每个动画都有明确的功能目的
- ⚡ **快速**: 动画时长控制在 200-300ms
- 🌊 **流畅**: 使用 CSS3 硬件加速和缓动函数
- 🎨 **一致**: 统一的动画语言和时序

**缓动函数**:

- **进入**: `cubic-bezier(0.25, 0.46, 0.45, 0.94)` (ease-out-quad)
- **退出**: `cubic-bezier(0.55, 0.06, 0.68, 0.19)` (ease-in-quad)
- **弹性**: `cubic-bezier(0.68, -0.55, 0.265, 1.55)` (back-out)

#### 3.2 悬浮球动画效果

**状态动画**:

- ✨ **空闲状态**: 轻微的呼吸动画 (scale: 1.0 ↔ 1.02)
- ✨ **悬停状态**: 放大 + 阴影扩散 (scale: 1.05, shadow: 0 12px 40px)
- ✨ **点击状态**: 脉冲 + 涟漪效果
- ✨ **拖拽状态**: 实时阴影跟随 + 磁性吸附

**检测状态动画**:

- 🔍 **检测中**: 旋转的扫描线动画
- 📊 **发现资源**: 从中心向外的波纹扩散
- 💫 **新资源**: 短暂的光晕闪烁效果

#### 3.3 侧边栏动画效果

**进入/退出动画**:

- 🚀 **滑入**: `transform: translateX(100%) → translateX(0)`
- 🌊 **淡入**: `opacity: 0 → 1`
- 📱 **背景模糊**: `backdrop-filter: blur(0px) → blur(24px)`

**内容动画**:

- 📋 **列表项**: 依次从右侧滑入，错开 50ms
- 🎨 **卡片悬停**: 轻微上浮 (translateY: 0 → -2px)
- 🔄 **状态切换**: 平滑的颜色和透明度过渡

#### 3.4 媒体预览动画

**播放器动画**:

- 🎬 **加载**: 骨架屏 → 淡入播放器
- 🎮 **控制栏**: 自动隐藏/显示 (opacity + translateY)
- 📺 **全屏**: 平滑的尺寸和位置过渡

**字幕动画**:

- 📝 **字幕切换**: 淡出 → 淡入 (crossfade)
- 🎨 **样式调整**: 实时预览效果
- 📍 **位置调节**: 平滑的位置过渡

### 4. 资源预览功能优化

#### 4.1 预览模式

- **内嵌预览**: 在侧边界面内直接预览
  - 小窗口播放器
  - 基本控制按钮
  - 音量调节
- **新标签页预览**: 独立页面全功能预览
  - 全屏播放支持
  - 完整播放器控制
  - 高级功能集成

#### 4.2 播放器功能规格

##### 4.2.1 基础播放控制

- ▶️ 播放/暂停
- ⏮️ 快退 (10 秒/30 秒可配置)
- ⏭️ 快进 (10 秒/30 秒可配置)
- 🔊 音量控制 (0-100%)
- 🔇 静音切换
- 📊 进度条拖拽

##### 4.2.2 高级播放功能

- 🚀 倍速播放 (0.25x - 4.0x)
- 🎬 全屏模式
- 🖼️ 画中画模式
- 📱 响应式控制界面
- ⌨️ 键盘快捷键支持

##### 4.2.3 本地字幕加载功能（重点特性）

**支持的字幕格式**:

- 📄 **SRT 格式**: 最常用的字幕格式，完整支持
- 📄 **VTT 格式**: Web 标准字幕格式，原生支持
- 📄 **ASS 格式**: 高级字幕样式格式，样式保持

**字幕加载方式**:

- 🖱️ **拖拽加载**: 直接拖拽字幕文件到播放器
- 📁 **文件选择**: 点击按钮选择本地字幕文件
- 🔍 **自动检测**: 自动检测同名字幕文件
- � **网络字幕**: 支持在线字幕 URL 加载

**字幕功能特性**:

- 🎨 **样式自定义**: 字体、大小、颜色、描边、背景
- 🌐 **多语言支持**: 多轨字幕切换和管理
- ⚙️ **同步调整**: 字幕时间偏移微调（±5 秒精度）
- 📝 **位置调节**: 字幕显示位置和边距设置
- 💾 **设置保存**: 用户字幕偏好设置记忆

#### 4.3 Video.js 播放器技术方案

**选择理由**: Video.js 是业界领先的开源 HTML5 视频播放器

- ✅ **丰富插件生态**: 字幕、快捷键、画中画等插件完善
- ✅ **高度可定制**: 支持自定义皮肤和控制组件
- ✅ **移动端友好**: 响应式设计，触摸操作优化
- ✅ **格式支持广泛**: 支持 HLS、DASH、MP4 等主流格式
- ✅ **社区活跃**: 持续更新维护，文档完善
- ✅ **轻量高效**: 核心库小于 100KB，性能优秀

### 5. 开发计划与里程碑

#### 5.1 优化的开发阶段

**阶段 1: 悬浮球与侧边栏界面开发 (2.5 周)**

- 🏗️ **项目基础搭建**:
  - 创建 Chrome 扩展基本结构 (manifest.json, 基础文件)
  - 设置开发环境和构建工具
  - 建立代码规范和项目配置

- 🎨 **悬浮球组件实现**:
  - 设计和实现圆形悬浮球 (56px, 渐变色彩)
  - 添加动画效果 (悬停、点击、拖拽、呼吸灯)
  - 实现位置记忆和磁性吸附功能
  - 响应式适配和移动端优化

- 📱 **侧边栏界面开发**:
  - 实现 360px 宽度的现代化侧边栏
  - 添加毛玻璃效果和深度阴影
  - 开发滑入/滑出动画和交互逻辑
  - 创建基础的资源列表布局

- 🧪 **阶段测试**:
  - UI 组件功能测试
  - 动画效果和性能测试
  - 跨浏览器兼容性初步验证
  - 用户交互体验测试

**阶段 2: 核心技术移植与资源检测 (3 周)**

- 🔧 **资源检测引擎移植**:
  - 移植 cat-catch 的 background.js 资源检测逻辑
  - 实现 webRequest API 网络监听和过滤
  - 开发 M3U8/MPD 流媒体格式解析器
  - 创建资源去重和智能过滤机制

- 💾 **数据存储与管理**:
  - 实现本地存储和缓存管理
  - 开发资源数据结构和状态管理
  - 创建数据持久化和同步机制
  - 添加存储配额管理和清理功能

- 🔍 **深度搜索功能**:
  - 移植 search.js 脚本注入式资源发现
  - 实现页面 DOM 解析和媒体元素检测
  - 开发动态内容监听和实时更新
  - 添加多种媒体格式识别支持

- 🧪 **阶段测试**:
  - 资源检测准确率测试 (目标 >95%)
  - 网络监听性能和稳定性测试
  - 数据存储和同步功能验证
  - 多网站兼容性测试

**阶段 3: 剩余 UI 完善与用户体验优化 (2 周)**

- 🎨 **界面细节完善**:
  - 完善资源列表的卡片式布局设计
  - 添加资源类型图标和颜色标识系统
  - 实现搜索过滤和分类显示功能
  - 优化加载状态和骨架屏动画

- ✨ **动画效果增强**:
  - 完善新资源的淡入动画效果
  - 添加资源卡片悬停和点击动画
  - 实现类型切换的平滑过滤动画
  - 优化全局动画系统和缓动函数

- 📊 **数据展示优化**:
  - 显示资源大小、时长、来源等详细信息
  - 实现资源状态指示和进度显示
  - 添加统计信息和数据可视化
  - 优化大量数据的渲染性能

- 🧪 **阶段测试**:
  - UI 响应时间测试 (目标 <100ms)
  - 动画流畅度测试 (目标 60fps)
  - 大数据量渲染性能测试
  - 用户体验和易用性测试

**阶段 4: 媒体预览功能开发 (3.5 周)**

- 🎬 **Video.js 播放器集成**:
  - 集成 Video.js 核心库和必要插件
  - 实现内嵌播放器 (320x180px) 和全屏模式
  - 开发自定义播放器皮肤和控制组件
  - 添加响应式设计和移动端适配

- 📄 **本地字幕加载功能**:
  - 支持 SRT、VTT、ASS 格式字幕解析
  - 实现拖拽加载和文件选择功能
  - 开发字幕样式自定义 (字体、颜色、位置)
  - 添加多语言字幕切换和时间同步调整

- 🚀 **高级播放功能**:
  - 实现倍速播放 (0.25x - 4.0x)
  - 添加画中画模式和全屏支持
  - 开发键盘快捷键和手势操作
  - 实现循环播放和播放列表功能

- ✨ **播放器动画效果**:
  - 添加播放器加载和淡入动画
  - 实现控制栏自动隐藏/显示效果
  - 开发字幕切换的淡入淡出动画
  - 优化全屏进入/退出的平滑过渡

- 🧪 **阶段测试**:
  - 播放器加载时间测试 (目标 <2s)
  - 字幕加载成功率测试 (目标 >95%)
  - 多格式媒体兼容性测试
  - 播放器功能完整性测试

**阶段 5: 综合测试与发布准备 (1.5 周)**

- 🔍 **全面功能测试**:
  - 端到端功能流程测试
  - 跨浏览器兼容性全面验证
  - 性能基准测试和内存占用监控
  - 安全性和隐私保护测试

- 🐛 **Bug 修复与优化**:
  - 收集和修复测试中发现的问题
  - 性能瓶颈识别和优化
  - 代码质量审查和重构
  - 用户反馈收集和改进

- 📦 **发布准备**:
  - 打包和构建流程优化
  - 文档完善和使用说明编写
  - 版本管理和发布计划制定
  - 应用商店提交准备

#### 5.2 各阶段成功指标

**阶段 1 - 界面开发指标**:
- 悬浮球动画流畅度 60fps
- 侧边栏滑入/滑出响应时间 < 300ms
- UI 组件渲染时间 < 50ms
- 跨浏览器兼容性 100%

**阶段 2 - 核心技术指标**:
- 资源检测准确率 > 95%
- 网络监听响应时间 < 100ms
- 数据存储读写性能 < 10ms
- 支持媒体格式覆盖率 > 90%

**阶段 3 - UI 完善指标**:
- 界面整体响应时间 < 100ms
- 大数据量 (1000+ 资源) 渲染时间 < 500ms
- 动画效果一致性和流畅度 100%
- 用户交互反馈及时性 < 50ms

**阶段 4 - 媒体预览指标**:
- 播放器加载时间 < 2s
- 字幕加载成功率 > 95%
- 多格式媒体支持率 > 95%
- 播放器功能完整性 100%

**最终综合指标**:
- 整体内存占用 < 30MB
- 扩展启动时间 < 1s
- 用户满意度 > 4.5/5.0
- 崩溃率 < 0.1%

### 6. 总结

Dog-Catch 将是一个专注于**自动检测**和**媒体预览**的简约浏览器插件，具有以下特点：

🎯 **核心功能**:

- 基于 cat-catch 技术的智能资源检测
- 集成 Video.js 的专业媒体预览
- 完整的本地字幕加载支持

🎨 **现代化设计**:

- 极简优雅的悬浮球设计
- 流畅的动画效果和交互
- 响应式的侧边栏界面

⚡ **技术优势**:

- 移植成熟稳定的核心技术
- 现代化的 Manifest V3 架构
- 跨平台浏览器兼容性

通过专注于两大核心功能和现代化的用户体验，Dog-Catch 将为用户提供简洁高效的媒体资源管理工具。

---

**文档版本**: v3.0 (简化版)
**创建日期**: 2025-08-06
**最后更新**: 2025-08-07
**项目**: Dog-Catch 浏览器插件开发
**技术基础**: 基于 Cat-Catch 核心技术，专注自动检测和媒体预览
